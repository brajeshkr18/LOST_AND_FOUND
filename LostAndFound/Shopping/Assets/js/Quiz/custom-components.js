var CF123_MAPS=[];var CF123_MAP=function(){this.map=null;this.marker=null;this.infoWindow=null;this.zoom=15;this.src=null;this.canvasID=null;this.controlID=false;this.defaultLocation=null;this.streetViewControl=false;this.addressFieldID=null;this.inputFieldID=null;this.mappedAddress=false;this.canUpdateMap=true;this.mapLocation=null;this.countriesWithTypo={"Bosnia and Herzegovina":"Bosnia Herzegovina","Macedonia (FYROM)":"Macedonia",Russia:"Russian Federation","North Korea":"Korea North","South Korea":"Korea South","Democratic Republic of the Congo":"Congo","Myanmar (Burma)":"Myanmar"};this.init=function(c){var a=this;for(var b in c){if(c.hasOwnProperty(b)){this[b]=c[b]}}this.mappedAddress=parseInt(this.addressFieldID)>0;this.initMap();this.initMarker();this.bindEvents()};this.initMap=function(){this.initMapLocation();this.createMap();this.createMapListener()};this.initMapLocation=function(){this.mapLocation=this.defaultLocation?this.getPositionByLocation(this.defaultLocation):new google.maps.LatLng(45.758930866245336,21.223625595141584)};this.createMap=function(){this.map=new google.maps.Map(document.getElementById(this.canvasID),{zoom:this.zoom,mapTypeId:google.maps.MapTypeId.ROADMAP,center:this.mapLocation,streetViewControl:this.streetViewControl});this.showAddress(this.defaultLocation,true)};this.createMapListener=function(){var a=this;if(!a.src){google.maps.event.addListenerOnce(a.map,"idle",function(){if(typeof $x!=="undefined"){var c=$x}var b=c("#map_canvas_"+a.controlID);if(c(b).css("opacity")=="0"){c(b).css("display","none").css("position","relative").css("opacity","1")}})}};this.initMarker=function(){this.createMarker();if(this.mappedAddress||parseInt(this.inputFieldID)>0){this.createMarkerListener();this.initInfoWindow()}};this.createMarker=function(){this.marker=new google.maps.Marker({position:this.mapLocation,title:""});this.marker.setMap(this.map);this.marker.setDraggable(true)};this.createMarkerListener=function(){var a=this;google.maps.event.addListener(a.marker,"dragend",function(){var b=a.marker.getPosition();a.map.panTo(b);a.geocode(b)})};this.initInfoWindow=function(){this.createInfoWindow();this.createInfoWindowListener()};this.createInfoWindow=function(){this.infoWindow=new google.maps.InfoWindow({content:'<div id="iw" style="display: none;"><strong>Instructions:</strong></div><div>You can drag this red marker anywhere on the map.</div>',maxWidth:"300",maxHeight:"300"});this.infoWindow.open(this.map,this.marker)};this.createInfoWindowListener=function(){var a=this;google.maps.event.addListener(this.marker,"dragstart",function(){a.infoWindow.close()})};this.fillAddressField=function(e){var b="",c="",h="",g="",d="",f="";if(typeof e[0]=="object"){e=e[0]}if(typeof e!=="object"||e.length===0){return}for(var a=0;a<e.address_components.length;a++){if(e.address_components[a]["types"][0]=="street_number"){b=e.address_components[a]["long_name"]}else{if(e.address_components[a]["types"][0]=="administrative_area_level_1"){h=e.address_components[a]["long_name"]}else{if(e.address_components[a]["types"][0]=="country"){g=e.address_components[a]["long_name"]}else{if(e.address_components[a]["types"][0]=="route"){c=e.address_components[a]["long_name"]}else{if(e.address_components[a]["types"][0]=="postal_code"){d=e.address_components[a]["long_name"]}else{if(e.address_components[a]["types"][0]=="locality"){f=e.address_components[a]["long_name"]}}}}}}}if(c!=undefined){$("#id123-control"+this.addressFieldID+"-1").val(c)}if(b!=undefined&&b!=""){$("#id123-control"+this.addressFieldID+"-2").val("No. "+b)}else{$("#id123-control"+this.addressFieldID+"-2").val("")}if(f!=undefined){$("#id123-control"+this.addressFieldID+"-3").val(f)}if(h!=undefined){$("#id123-control"+this.addressFieldID+"-4").val(h)}if(d!=undefined){$("#id123-control"+this.addressFieldID+"-5").val(d)}if(g!=undefined){$("#s2id_id123-control"+this.addressFieldID+"-6").removeClass("select2-updated");if($("#id123-control"+this.addressFieldID+'-6 option[value="'+g+'"]').length===0&&this.countriesWithTypo[g]){g=this.countriesWithTypo[g]}$("#id123-control"+this.addressFieldID+"-6").val(g).trigger("change")}};this.fillInputFieldCoordonates=function(){if(this.marker.getPosition().lat()!=""&&this.marker.getPosition().lng()!=""){$("#id123-control"+this.inputFieldID).val(this.marker.getPosition().lat()+","+this.marker.getPosition().lng())}};this.createMapSearchBoxInput=function(){var a=document.createElement("input");a.type="text";a.id="search-for-google-map-"+this.controlID;a.className="google-map-search-control";a.placeholder="Search an address";a.style.margin="8px";a.style.padding="10px";a.style.width="200px";a.addEventListener("keypress",function(b){if(b.which==13){b.preventDefault();b.stopPropagation()}});return a};this.bindMapSearchBoxInput=function(){var a=this.createMapSearchBoxInput();this.map.controls[google.maps.ControlPosition.TOP_LEFT].push(a);return new google.maps.places.SearchBox(a)};this.createMapSearchBox=function(){var a=this;var b=this.bindMapSearchBoxInput();this.map.addListener("bounds_changed",function(){b.setBounds(a.map.getBounds())});b.addListener("places_changed",function(){var c=b.getPlaces();if(c.length==0){return}var d=new google.maps.LatLngBounds();var e=false;var f=false;c.forEach(function(g){if(g.geometry.viewport){d.union(g.geometry.viewport)}else{d.extend(g.geometry.location);e=g.geometry.location}f=g});a.map.fitBounds(d);if(!e){e=a.map.getCenter()}a.marker.setPosition(e);if(f){a.fillAddressField(f);a.fillInputFieldCoordonates()}})};this.getAddressFromField=function(){var a="";for(var c=1;c<=6;c++){var b=$("#id123-control"+this.addressFieldID+"-"+c);if($(b).val().trim()!=""&&!(c==6&&$(b).val().trim()=="Other")){a+=$(b).val();if(c<6){a+=", "}}}return a};this.getPositionByLocation=function(a){geocoder.geocode({address:a},function(c,b){if(b==google.maps.GeocoderStatus.OK){return c[0].geometry.location}})};this.showAddress=function(b,a){var c=this;geocoder.geocode({address:b},function(e,d){if(d==google.maps.GeocoderStatus.OK){c.marker.setPosition(e[0].geometry.location);c.geocode(e[0].geometry.location,a)}else{}})};this.geocode=function(a,b){var c=this;geocoder.geocode({latLng:a},function(d){c.map.panTo(c.marker.getPosition());if(c.inputFieldID){c.fillInputFieldCoordonates()}if(c.addressFieldID){if(c.canUpdateMap===false||b===true){return}c.fillAddressField(d)}})};this.refresh=function(){if(typeof(this.map)!="undefined"){var a=this.map.getCenter();google.maps.event.trigger(this.map,"resize");this.map.setCenter(a)}};this.bindEvents=function(){var a=this;$(document).ready(function(){if(a.mappedAddress){setTimeout(function(){a.createMapSearchBox()},500);for(var f=1;f<=6;f++){var g=$("#id123-control"+a.addressFieldID+"-"+f);$(g).keyup(function(){a.showAddress(a.getAddressFromField())});$(g).focusin(function(){a.canUpdateMap=false});$(g).focusout(function(){a.canUpdateMap=true})}var k=$("#id123-control"+a.addressFieldID+"-1");var j=k.val()!=undefined?k.val().trim():"";var m=$("#id123-control"+a.addressFieldID+"-2");var e=m.val()!=undefined?m.val().trim():"";var n=$("#id123-control"+a.addressFieldID+"-3");var b=n.val()!=undefined?n.val().trim():"";var h=$("#id123-control"+a.addressFieldID+"-4");var d=h.val()!=undefined?h.val().trim():"";var c=$("#id123-control"+a.addressFieldID+"-5");var l=c.val()!=undefined?c.val().trim():"";if(j!=""||e!=""||b!=""||d!=""||l!=""){a.showAddress(a.getAddressFromField(),true)}}})}};function get_social_counts(c,b,a){$.ajax({type:"GET",url:"/ajax_form.php?modulename=sf_social_actions.php&action=get_counters&items="+a+"&url="+b,dataType:"json",success:function(g){var f=$("#id123-control-"+c+" a.twitter span.social-count");if($(f).length>0){$(f).html(g.twitter)}var i=$("#id123-control-"+c+" a.facebook-like span.social-count");if($(i).length>0){$(i).html(g.facebook_like)}var h=$("#id123-control-"+c+" a.facebook-share span.social-count");if($(h).length>0){$(h).html(g.facebook_share)}var e=$("#id123-control-"+c+" a.google-plus span.social-count");if($(e).length>0){$(e).html(g.google_plus)}var d=$("#id123-control-"+c+" a.linkedin span.social-count");if($(d).length>0){$(d).html(g.linkedin)}}})};